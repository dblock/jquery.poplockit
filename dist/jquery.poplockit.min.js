/*! jQuery.popLockIt - v0.1.0 - 2013-01-08
* https://github.com/zamiang/jquery.popLockIt
* Copyright (c) 2013 Brennan Moore; Licensed MIT */
(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},n=function(e,t){return function(){return e.apply(t,arguments)}};(function(e,r,i){var s,o,u,a,f;return f="popLockIt",s=function(){function e(e,t){var n,r,i,s;s=this.requires;for(r=0,i=s.length;r<i;r++){n=s[r];if(t[n]==null)throw"You must pass "+n}}return e.prototype.requires=[],e}(),o=function(e){function n(e,t){n.__super__.constructor.call(this,e,t),this.$el=e,this.settings=t,this.setDimensions(t.height,t.marginTop,t.marginBottom,t.marginLeft),this}return t(n,e),n.prototype.requires=["height","marginTop","marginLeft","marginBottom"],n.prototype.cssProperties=["position","top","bottom","left"],n.prototype.setDimensions=function(e,t,n,r){e&&(this.parentHeight=e),t&&(this.marginTop=t),n&&(this.marginBottom=n),r&&(this.marginLeft=r),this.height=Number(this.$el.css("height").replace("px","")),this.top=this.$el.offset().top-this.marginTop,this.left=this.$el.offset().left,this.bottom=this.top+this.parentHeight-this.height-this.marginBottom*2;if(this.top<1)return this.top=1},n.prototype.setPosition=function(e,t){var n,r,i,s,o,u,a;e==null&&(e="absolute"),t==null&&(t="north"),i={position:e,top:t==="north"?this.marginTop:"auto",bottom:t==="south"?this.marginBottom:"auto",left:e==="fixed"?this.left:this.left-(this.marginLeft||0)};if(!this.oldState)return this.$el.css(i),this.oldState=i;r={},n=!1,a=this.cssProperties;for(o=0,u=a.length;o<u;o++)s=a[o],i[s]!==this.oldState[s]&&(r[s]=i[s],n=!0);if(n)return this.$el.css(r),this.oldState=i},n.prototype.onScroll=function(e,t,n){if(!n&&e>=this.top&&e<this.bottom)return this.setPosition("fixed");if(e<this.top)return this.setPosition("absolute","north");if(e>=this.bottom)return this.setPosition("absolute","south")},n.prototype.destroy=function(){return this.setPosition()},n}(s),a=function(n){function r(t,n){var i,s,u;r.__super__.constructor.call(this,t,n),this.$el=t,this.settings=n,this.setDimensions(),this.$columns=this.$el.find(n.columnSelector),i=this.height,s=this.left,((u=this.$columns)!=null?u.length:void 0)>0&&(this.columns=this.$columns.map(function(){return new o(e(this),{height:i,marginTop:n.marginTop,marginBottom:n.marginBottom,marginLeft:s})})),this}return t(r,n),r.prototype.requires=["columnSelector"],r.prototype.setDimensions=function(){var e;return e=this.$el.css("height"),this.height=Number(e.replace("px","")),this.$el.css({height:this.height,position:"relative"}),this.left=this.$el.offset().left,this.top=this.$el.offset().top-this.settings.marginTop,this.bottom=this.top+this.height},r.prototype.onScroll=function(e,t){var n,r,i,s,o,u,a,f;if(t>=this.height)this.active=!1;else{if(e>=this.top&&e<this.bottom){this.active=!0,u=this.columns,f=[];for(r=0,s=u.length;r<s;r++)n=u[r],f.push(n.onScroll(e,t));return f}if(this.active){a=this.columns;for(i=0,o=a.length;i<o;i++)n=a[i],n.onScroll(e,t,!0);return this.active=!1}}},r.prototype.destroy=function(){var e,t,n,r,i;r=this.columns,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.destroy());return i},r}(s),u=function(i){function s(t,i){this.onResize=n(this.onResize,this);var o;this.$el=e(t),s.__super__.constructor.call(this,this.$el,i);if(!(((o=this.$el)!=null?o.length:void 0)>0))throw"PopLockIt must be called on an element";if(i==null)throw"You must pass settings";this.$window=e(r),this.detectiOS(),this.initRequestAnimationFrame(),this.setViewportHeight(),this.$el.css({"box-sizing":"border-box",overflow:"hidden"}),this.settings=e.extend(this.defaults,i),this.settings.marginTop=Number(this.$el.css("padding-top").replace("px","")),this.settings.marginBottom=Number(this.$el.css("padding-bottom").replace("px","")),this.addFeedItems(this.settings.feedItems),this.bindWindowEvents(),this}return t(s,i),s.prototype.feedItems=[],s.prototype.requires=["feedItems"],s.prototype.defaults={active:!0,rendered:!1},s.prototype.onScroll=function(){var e,t,n,i,s,o=this;if(!this.settings.active)return;t=this.$window.scrollTop();if(t===this.previousScrollTop)return r.requestAnimationFrame(function(){return o.onScroll()});s=this.feedItems;for(n=0,i=s.length;n<i;n++)e=s[n],e.onScroll(t,this.viewportHeight);return this.previousScrollTop=t,r.requestAnimationFrame(function(){return o.onScroll()})},s.prototype.recompute=function(){var e,t,n,r,i,s;i=this.feedItems,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],t.setDimensions(),s.push(function(){var n,r,i,s;i=t.columns,s=[];for(n=0,r=i.length;n<r;n++)e=i[n],s.push(e.setDimensions(t.height,t.settings.marginTop,t.settings.marginBottom,t.left));return s}());return s},s.prototype.addFeedItems=function(t){var n;if(t==null||!t.length)throw"You must pass $feedItems";return this.feedItems=this.feedItems.concat(function(){var r,i,s;s=[];for(r=0,i=t.length;r<i;r++)n=t[r],s.push(new a(e(n),this.settings));return s}.call(this))},s.prototype.onResize=function(){var e,t,n,r,i;this.setViewportHeight(),r=this.feedItems,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.onScroll(this.previousScrollTop,this.viewportHeight));return i},s.prototype.setViewportHeight=function(){return this.viewportHeight=this.$window.outerHeight(!0)},s.prototype.bindWindowEvents=function(){var e=this;r.requestAnimationFrame(function(){return e.onScroll()});if(!this.IS_IOS)return this.$window.bind("resize.feedItem",this.debounce(this.onResize,100))},s.prototype.unbindWindowEvents=function(){return this.$window.unbind(".feedItem")},s.prototype.destroy=function(){var t,n,i,s;e(r).unbind("resize.popLockIt"),this.settings.rendered=!1,this.settings.active=!1,s=this.items;for(n=0,i=s.length;n<i;n++)t=s[n],this.feedItems.destroy();return this.unbindWindowEvents()},s.prototype.debounce=function(e,t){var n;return n=0,function(){var r,i,s=this;return r=arguments,i=function(){return n=null,e(r)},clearTimeout(n),n=setTimeout(i,t)}},s.prototype.detectiOS=function(){var e;return e=navigator.userAgent.toLowerCase(),this.IS_IOS=e.match(/(iPhone|iPod|iPad)/i)!=null},s.prototype.initRequestAnimationFrame=function(){var e,t,n,i,s;if(r.requestAnimationFrame)return;e=0,n=["ms","moz","webkit","o"];for(i=0,s=n.length;i<s;i++)t=n[i],r.requestAnimationFrame||(r.requestAnimationFrame=r[""+t+"RequestAnimationFrame"]);if(!r.requestAnimationFrame)return r.requestAnimationFrame=function(t,n){var i,s,o;return i=(new Date).getTime(),o=Math.max(0,16-(i-e)),s=r.setTimeout(function(){return t(i+o)},o),e=i+o,s}},s}(s),e.fn[f]=function(t){if(!e.data(this,"plugin_"+f)){if(t==null)throw"You must pass settings";return e.data(this,"plugin_"+f,new u(this,t))}if(e.data(this,"plugin_"+f)[t]!=null)return e.data(this,"plugin_"+f)[t](Array.prototype.slice.call(arguments,1))}})(jQuery,window,document)}).call(this);