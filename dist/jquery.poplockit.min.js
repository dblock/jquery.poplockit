/*! jQuery.popLockIt - v0.1.0 - 2013-01-03
* https://github.com/zamiang/jquery.popLockIt
* Copyright (c) 2013 Brennan Moore; Licensed MIT */
(function(){var e,t,n,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},a=function(e,t){return function(){return e.apply(t,arguments)}};e=jQuery,t=function(){function e(e,t){var n,r,i,s;s=this.requires;for(r=0,i=s.length;r<i;r++){n=s[r];if(t[n]==null)throw"You must pass "+n}}return e.prototype.requires=[],e}(),n=function(e){function t(e,n){t.__super__.constructor.call(this,e,n),this.$el=e,this.settings=n,this.height=n.height,this.setDimensions(),this}return u(t,e),t.prototype.requires=["height","margin"],t.prototype.setDimensions=function(e){return e&&(this.height=e),this.top=this.$el.offset().top-this.settings.margin,this.left=this.$el.offset().left,this.bottom=this.top+this.height-this.$el.outerHeight(!0)},t.prototype.setPosition=function(e,t){return e==null&&(e="absolute"),t==null&&(t="north"),this.$el.css({position:e,top:t==="north"?this.settings.margin:"auto",bottom:t==="south"?this.settings.margin:"auto",left:this.left})},t.prototype.onScroll=function(e,t){if(t>=this.height)return;if(e>=this.top&&e<this.bottom)return this.setPosition("fixed");if(e<this.top)return this.setPosition("absolute","north");if(e>=this.bottom)return this.setPosition("absolute","south")},t.prototype.destroy=function(){return this.setPosition()},t}(t),i=function(t){function r(t,i){var s,o;r.__super__.constructor.call(this,t,i),this.$el=t,this.settings=i,this.setDimensions(),this.$columns=this.$el.find(i.columnSelector),s=this.height,((o=this.$columns)!=null?o.length:void 0)>0&&(this.columns=this.$columns.map(function(){return new n(e(this),{height:s,margin:i.margin})})),this}return u(r,t),r.prototype.requires=["columnSelector"],r.prototype.setDimensions=function(){return this.height=this.$el.outerHeight(!0),this.top=this.$el.offset().top-this.settings.margin,this.bottom=this.top+this.height,this.$el.css({height:""+this.height+"px",position:"relative"})},r.prototype.onScroll=function(e,t){var n,r,i,s,o,u,a,f;if(e>=this.top&&e<this.bottom){this.active=!0,u=this.columns,f=[];for(r=0,s=u.length;r<s;r++)n=u[r],f.push(n.onScroll(e,t));return f}if(this.active){a=this.columns;for(i=0,o=a.length;i<o;i++)n=a[i],n.onScroll(e,t);return this.active=!1}},r.prototype.destroy=function(){var e,t,n,r,i;r=this.columns,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.destroy());return i},r}(t),r=function(t){function n(t,r){this.onResize=a(this.onResize,this),n.__super__.constructor.call(this,t,r);if(!(t.length>0))throw"PopLockIt must be called on an element";this.$el=t,this.$window=e(window),this.detectiOS(),this.initRequestAnimationFrame(),this.settings=e.extend(this.defaults,r),this.addFeedIitems(this.settings.feedItems),this.bindWindowEvents()}return u(n,t),n.prototype.defaults={active:!0,rendered:!1},n.prototype.feedItems=[],n.prototype.requires=["feedItems"],n.prototype.addFeedIitems=function(t){var n;return this.feedItems=this.feedItems.concat(function(){var r,s,o;o=[];for(r=0,s=t.length;r<s;r++)n=t[r],o.push(new i(e(n),this.settings));return o}.call(this))},n.prototype.onScroll=function(){var e,t,n,r,i,s=this;if(!this.settings.active)return;t=this.$window.scrollTop();if(t===this.previousScrollTop)return window.requestAnimationFrame(function(){return s.onScroll()});this.scrollingDown=this.previousScrollTop<t,i=this.feedItems;for(n=0,r=i.length;n<r;n++)e=i[n],e.onScroll(t,this.height);return this.previousScrollTop=t,window.requestAnimationFrame(function(){return s.onScroll()})},n.prototype.onResize=function(){var e,t,n,r;r=this.feedItems;for(t=0,n=r.length;t<n;t++)e=r[t],e.onScroll(this.previousScrollTop,this.$window.height());return this.height=this.$window.outerHeight(!0)},n.prototype.bindWindowEvents=function(){var e=this;window.requestAnimationFrame(function(){return e.onScroll()});if(!this.IS_IOS)return this.$window.bind("resize.feedItem",this.debounce(this.onResize,100))},n.prototype.unbindWindowEvents=function(){return this.$window.unbind(".feedItem")},n.prototype.destroy=function(){var e,t,n,r;this.settings.rendered=!1,this.settings.active=!1,r=this.items;for(t=0,n=r.length;t<n;t++)e=r[t],this.feedItems.destroy();return this.unbindWindowEvents()},n.prototype.debounce=function(e,t){var n;return n=0,function(){var r,i,s=this;return r=arguments,i=function(){return n=null,e(r)},clearTimeout(n),n=setTimeout(i,t)}},n.prototype.detectiOS=function(){var e;return e=navigator.userAgent.toLowerCase(),this.IS_IOS=e.match(/(iPhone|iPod|iPad)/i)!=null},n.prototype.initRequestAnimationFrame=function(){var e,t,n,r,i;if(window.requestAnimationFrame)return;e=0,n=["ms","moz","webkit","o"];for(r=0,i=n.length;r<i;r++)t=n[r],window.requestAnimationFrame||(window.requestAnimationFrame=window[""+t+"RequestAnimationFrame"]);if(!window.requestAnimationFrame)return window.requestAnimationFrame=function(t,n){var r,i,s;return r=(new Date).getTime(),s=Math.max(0,16-(r-e)),i=window.setTimeout(function(){return t(r+s)},s),e=r+s,i}},n}(t),s={initialize:function(t){if(t==null)throw"You must pass settings";return this.feed=new r(e(this),t),this},destroy:function(){return e(window).unbind("resize.popLockIt"),this.feed.destroy()},recompute:function(){var e,t,n,r,i,s;i=this.feed.feedItems,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],t.setDimensions(),s.push(function(){var n,r,i,s;i=t.columns,s=[];for(n=0,r=i.length;n<r;n++)e=i[n],s.push(colum.setDimensions(t.height));return s}());return s},onScroll:function(){return this.feed.onScroll()},addFeedItems:function(e){if(e==null||!e.length)throw"You must pass $feedItems";return this.feed.addFeedIitems(e)}},e.fn.popLockIt=function(t){return s[t]!=null?s[t].apply(this,Array.prototype.slice.call(arguments,1)):typeof t=="object"||t==null?s.initialize.apply(this,arguments):e.error("Method "+t+" does not exist on jQuery.popLockIt")}}).call(this);